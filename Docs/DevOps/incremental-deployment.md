# incremental deployment

최근 커밋만 배포하는 전략은 최근 변경된 파일이나 리소스만 서버에 배포하는 방식을 말한다.  
이런 전략은 배포 시간을 줄이고, 배포 중 발생할 수 있는 문제를 최소화한다는 장점이 있다.

## 방법

```
# 마지막 배포된 커밋(OLD_COMMIT)과 현재 HEAD 간의 변경된 파일 목록 출력
git diff --name-only OLD_COMMIT HEAD
```

위 명령어는 두 커밋 사이에 변경된 파일들의 이름만 반환하는데 이것만 배포하는 것이다.

변경사항을 어떻게 배포할 것인지는 여러 방법이 있다.

1. 코드 변경: 변경된 파일이 포함된 모듈만 다시 빌드.
2. 정적 리소스: 변경된 파일만 서버에 복사.

## 배포

1. rsync 사용

```
rsync -av --files-from=<(git diff --name-only OLD_COMMIT HEAD) ./ target_server:/path/to/deploy

```

변경된 파일만 원격 서버로 복사해 배포하는 방식이다.

2. S3, FTP 또는 기타 스토리지

```
git diff --name-only OLD_COMMIT HEAD | xargs -I {} aws s3 cp {} s3://my-bucket/path/{}

```

## 결론

이 배포방식을 보면 알겠지만, Docker 이미지 빌드 방식은 전체 프로젝트 파일을 기반으로 이미지를 생성하기 때문에, 특정 커밋에서 변경된 파일만 포함하는 방식으로는 동작하지 않는다.  
이는 Docker 빌드가 파일 시스템의 **컨텍스트(context)**를 기반으로 동작하기 때문이다.  
때문에 특정 커밋만 복사해 배포하는 방식은 정적 이미지 배포 같은 프론트엔드 서버 배포에는 적절한 배포방식일 수 있으나 백엔드 서버 배포에는 현실적으로 제약
이 있어보인다.
