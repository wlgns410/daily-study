# row lock과 table lock

**Row Lock(행 잠금)**과 **Table Lock(테이블 잠금)**은 데이터베이스에서 동시성 제어를 위한 잠금(lock) 메커니즘의 두 가지 주요 유형이다.

## row lock

특정 행(row)에만 적용되는 잠금인데, 데이터의 동시성을 유지하면서도 필요한 최소한의 자원만 잠그는 방식이다.

### 특징

- 잠금 범위: 특정 행(row)만 잠금 대상
- 목적: 특정 데이터의 일관성을 보장하면서도 다른 행에 대한 작업은 허용함
- 사용 방법 : SELECT ... FOR UPDATE: 특정 행을 업데이트하거나 삭제하기 전에 잠그는 데 사용 또는 UPDATE 또는 DELETE 명령 실행 중 사용
- 동시성: 높은 동시성을 제공하며 다른 트랜잭션이 잠기지 않은 행에 대해 작업할 수 있음
- 성능: 필요한 데이터만 잠그므로 일반적으로 테이블 락보다 성능이 우수함

```sql
-- 특정 행에 대해 잠금
BEGIN;
SELECT * FROM users WHERE id = 1 FOR UPDATE;

-- 이 트랜잭션이 종료될 때까지 다른 트랜잭션은 이 행을 수정할 수 없음.
UPDATE users SET name = 'Alice' WHERE id = 1;
COMMIT;
```

### 장점

최소한의 잠금 범위로 다른 트랜잭션의 작업을 방해하지 않음  
대규모 테이블에서도 효율적으로 사용 가능

### 단점

다수의 행이 동시에 잠기면 성능 저하나 데드락(교착 상태) 발생 가능

## table lock

Table Lock은 특정 테이블 전체를 대상으로 적용되는 잠금이며 데이터베이스에서 전체 테이블의 일관성을 보장하기 위해 사용된다.

### 특징

- 잠금 범위: 테이블 전체가 잠금 대상
- 목적: 데이터의 무결성을 보장하며, 동시에 트랜잭션 간 충돌을 방지
- 사용 시점: 대규모 테이블 업데이트/삭제 작업 시 또는 데이터베이스 관리 작업과 같이 테이블 구조에 변경이 되는 작업
- 명시적 잠금(LOCK TABLE 문 사용)으로 잠금 설정
- 동시성: 낮은 동시성을 제공합니다. 다른 트랜잭션은 해당 테이블의 데이터에 접근할 수 없음
- 성능: 테이블 크기가 큰 경우 혹은 동시에 많은 요청이 들어오면 성능 병목 발생

```sql
-- 테이블 전체를 잠금
LOCK TABLE users IN EXCLUSIVE MODE;

-- 이 트랜잭션 동안 다른 트랜잭션은 테이블에 접근 불가
UPDATE users SET name = 'Bob' WHERE id = 2;
COMMIT;
```

### 장점

단순한 잠금 방식으로 구현이 용이  
데이터 충돌 가능성이 적음

### 단점

동시성이 낮아져, 많은 사용자나 트랜잭션이 있는 환경에서는 비효율적  
불필요하게 넓은 범위를 잠그는 경우가 많아 성능 저하 가능

## 결론

Row Lock은 동시성을 최대화하면서 필요한 데이터만 잠그는 데 유리하며, Table Lock은 단순한 작업이나 테이블 전체를 대상으로 작업할 때 적합하다고 한다.  
하지만 이는 서비스마다 다를 수 있으며, 트랜잭션 설계 시 데이터 잠금 범위와 동시성 요구 사항을 고려하여 적절한 잠금 방식을 선택하는 것이 중요할 것이다.
