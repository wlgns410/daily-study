# varchar와 text

## VARCHAR (Variable-Length Character)

가변 길이 문자열로 저장된다.  
따라서 필요한 길이에 따라서 해당 공간만 차지한다.

## TEXT

길이에 제한이 없는 문자열 저장 방식이다.  
TEXT 필드는 TOAST(The Oversized-Attribute Storage Technique)라는 메커니즘을 통해 관리된다.
TEXT 필드의 데이터가 너무 커지면, PostgreSQL은 해당 데이터를 외부 TOAST 테이블에 저장하고, 본래 테이블에는 포인터를 저장하는 방식이다.

### TOAST

장점

- 공간 최적화 : 테이블의 전체 크기를 줄여 디스크 공간을 절약하고 테이블 스캔 성능을 향상시킴
- 효율적인 메모리 사용 : 포인터만 테이블에 기록해 테이블 자체를 가볍게 유지

단점

- 추가적인 I/O : 긴 텍스트가 별도의 저장소에 위치해 있기 때문에, 이를 읽어오는 과정에서 기본 테이블 외의 별도 저장 영역을 참조해야 하므로 조회 속도가 다소 느려질 수 있음
- 인덱스 성능 저하 가능성 : 전체 텍스트 검색(Full-Text Search)과 같이 내용의 일부를 대상으로 검색할 때 성능 저하가 발생할 수 있음. 또한 TEXT 필드가 매우 길어지는 경우, 기본적으로 제공되는 인덱스(B-Tree)는 텍스트 전체를 인덱싱하는 데 비효율적일 수도 있음
- 추가적인 설정 : 긴 텍스트를 효과적으로 처리하기 위해서는 전체 텍스트 검색 인덱스(GIN)와 같은 인덱스를 추가로 설정해야 인덱스 효과를 볼 수 있음

## TEXT와 VARCHAR의 성능 차이

둘 다 최대 길이에 대한 차이 외에는 성능상 큰 차이가 있지 않다.  
다만, VARCHAR(n)과 같은 고정 길이를 지정하면 데이터베이스는 그 길이를 초과하는 데이터를 방지하기 위한 추가적인 체크를 하는 제한 조건이 필요할 수 있다.

## 인덱싱

### 기본값은 B-Tree

- PostgreSQL에서 기본적으로 사용하는 인덱스 타입은 B-Tree입니다. 이는 TEXT, VARCHAR, INTEGER 등 대부분의 필드에 대해 기본적으로 적용함

### Full-Text Search의 필요성

- B-Tree 인덱스는 텍스트 비교와 정렬에 적합하지만, 긴 문자열의 부분 검색(예: 특정 단어의 포함 여부)을 처리할 때는 성능이 저하함
  -> 이 경우 PostgreSQL은 Full-Text Search 인덱스(예: GIN 또는 GiST)를 사용하는 것이 더 효율적임 Full-Text Search는 텍스트 필드 내의 단어나 문장 검색에 최적화된 인덱싱 방식을 제공
