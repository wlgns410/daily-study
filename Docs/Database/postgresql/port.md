# 데이터베이스 포트 관리

서버가 1개의 경우에 PORT를 여러개 열어서 관리하는 것을 볼 수 있다.  
그 이유를 알아보자.

## 접속 정책 및 보안

PostgreSQL의 pg_hba.conf 파일을 이용해 내부와 외부의 접근을 제어한다.  
예를 들어, 외부 클라이언트는 5432 포트로 접근하고 내부 서버에서는 5433 포트로 접근하도록 설정해 보안을 향상시킬 수 있다.

```
# pg_hba.conf 예시
# 5432 포트: 외부에서의 접근 허용
host    all             all             0.0.0.0/0               md5

# 5433 포트: 내부 네트워크에서만 접근 허용
host    all             all             192.168.0.0/24          trust
```

- 보안강화
  외부 네트워크는 보안에 취약할 수 있어 이를 별도의 포트로 제한하고 `추가적인 인증(md5)`를 요구해 무단 접근을 방지할 수 있고
  내부 네트워크는 `trust` 모드로 접근을 허용해 외부 적은보다 엄격하게 관리할 수 있다.

- 네트워크 정책 차별화
  외부 포트에 대해서는 방화벽 설정을 강화하거나 VPN을 통해 접근하도록 제한할 수 있다.
  내부 네트워크에 대해서는 더 낮은 인증 수준으로 빠르게 접근할 수 있도록 차별화할 수 있다.

- 성능 최적화
  내부와 외부 트래픽을 분리하여 병목현상 없이 안정적으로 네트워크 자원을 관리할 수 있다.  
  또한 우선순위를 부여해서 내부 네트워크에서 운영팀이 관리하거나, 시스템의 백엔드 작업이 안정적으로 이루어지도록 외부보다 높은 우선순위로 처리하게 할 수 있다.

## 다중 애플리케이션 연결

웹 애플리케이션 A는 5432 포트, 모바일 애플리케이션 B는 5434 포트를 사용하여 동일한 데이터베이스에 연결하는 방식으로 트래픽을 관리할 수 있다.

```
# postgresql.conf 예시
# 웹 애플리케이션 A용 포트
port = 5432

# 모바일 애플리케이션 B용 포트 (추가 인스턴스 구성 필요)
port = 5434
```

웹과 모바일은 보통 다른 트래픽 패턴과 사용량을 보인다.  
포트를 분리하면 각 트래픽을 개별적으로 모니터링 할 수 있고 이는 트래픽 폭증이 다른 어플리케이션에 영향을 미치는것을 줄일 수 있다.  
이는 포트별로 로드밸런서 설정이 가능하기 때문에 어플리케이션 별 요구사항에 적합하게 대응하기 쉬워진다.

또한 어플리케이션 별로 접근 제한이나 네트워크 정책을 다르게 설정할 수 있다.  
이는 어플리케이션의 보안 강화 측면에서도 유리해질 수 있다.

## 데이터베이스 관리 및 모니터링

관리 및 모니터링 툴에서 접근할 수 있도록 특정 포트를 추가로 개방하곤 한다.  
어드민용 포트를 5435로 설정해, 이 포트로만 모니터링 툴이 접근할 수 있게 한다.

```
# postgresql.conf 예시
# 클라이언트 접근용 포트
port = 5432

# 모니터링 서비스 접근용 포트
port = 5435
```

모니터링 툴이 사용하는 포트를 일반 어플리케이션과 분리하면 접근을 제한해 모니터링 트래픽 감시가 수월해진다.  
또한 모니터링 툴과 어플리케이션이 같은 포트를 사용하면 모니터링에서의 I/O 부하가 어플리케이션 성능에 영향을 줄 수 있다.  
별도의 포트로 관리하면 모니터링 트래픽을 독립적으로 관리해 운영 성능을 향상시킬 수 있다.

## 테스트 및 개발 환경 분리

동일한 데이터베이스 인스턴스에서, 개발과 테스트 환경을 포트로 구분할 수 있다.  
예를 들어, 5432 포트는 운영용, 5436 포트는 테스트 환경에서만 사용하도록 할 수 있다.

```
# postgresql.conf 예시
# 운영 환경
port = 5432

# 테스트 환경
port = 5436
```

이렇게 설정하면, 데이터베이스를 추가적으로 띄우지 않고도 개발 및 테스트 환경을 구분해서 사용하므로 초기 운영 비용을 절감할 수 있어 작은 스타트업에서는 유용한 방법으로 사용될 수 있다.
