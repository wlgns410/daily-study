# esm과 commonjs

ECMAScript Modules은 js의 모듈 시스템 부족을 해결하기 위해 탄생했다.

## JavaScript 모듈 시스템의 부재

JavaScript는 본래 모듈화를 위한 언어적 지원이 부족했기 때문에, 커뮤니티와 다양한 환경에서 자체적인 모듈 시스템이 생겼다.  
대표적인 모듈 시스템이 CommonJS와 AMD(Asynchronous Module Definition)였다.

## CommonJS의 한계

CommonJS는 서버측에서 js를 효율적으로 처리하기 위해 채택했다.  
Nodejs는 이를 채택해 동기적으로 파일을 불러오는 방식이 문제가 되지 않았다.  
서버는 한 번 불러오면 파일을 캐시해서 빠르게 처리할 수 있었기 때문이다.

하지만, 브라우저 환경에서는 문제가 될 수 있었다.  
브라우저는 페이지가 로드될 때 필요한 모든 파일을 서버로부터 가져와야한다.  
이 파일을 가져오는 작업이 느리거나 네트워크 환경이 불안정하면 브라우저는 파일을 가져올 때까지 아무 작업을 못하게 되어 페이지 로딩 속도가 느려진다.

브라우저는 비동기적으로 자원을 로드하는 것이 더 적합하다.  
여러 파일을 동시에 가져오거나 파일을 불러오는 동안에도 다른 작업을 진행해야한다.  
따라서 Commonjs의 require() 방식은 파일이 로드될 때까지 기다려야하므로 브라우저에서는 비효율적이게 된 것이다.

## ECMAScript

ESM에서는 모듈을 비동기적으로 로드할 수 있다.  
이는 브라우저가 모듈을 로드하는 동안 다른 작업을 병행할 수 있도록 하므로 페이지 로딩 속도가 빨라진다.

또한 트리 세이킹을 지원한다.  
사용되지 않는 코드를 제거해 최적화하는 기법을 말하는데, ESM은 정적 분석을 통해 필요한 부분만 불러오기 때문에 트리세이킹이 가능하다.  
이는 번들 크기 감소와 성능 개선에 큰 영향을 줬고 ESM이 채택되는데 큰 역할을 했다.

---

참고

nodejs 디자인패턴바이블
